<div class="space-y-6">
  <h1 class="text-2xl font-bold">Ryanair Flight Search</h1>

  <!-- Search Form Card -->
  <div class="card bg-base-100 shadow-xl" data-controller="ryanair-search">
    <div class="card-body">
      <h2 class="card-title">Search for Flights from Riga (RIX)</h2>

      <%= form_with url: tickets_ryanair_path, method: :post do |f| %>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 items-end">
          <!-- Destination -->
          <div class="form-control">
            <label class="label" for="destination_code">
              <span class="label-text">Destination</span>
            </label>
            <select name="destination_code" id="destination_code"
                    class="select select-bordered w-full"
                    data-ryanair-search-target="destinationSelect"
                    data-action="change->ryanair-search#destinationChanged">
              <option value="">Select destination</option>
              <% @destinations.each do |destination| %>
                <option value="<%= destination.code %>"><%= destination.display_name %></option>
              <% end %>
            </select>
          </div>

          <!-- Date Out -->
          <div class="form-control" data-ryanair-search-target="dateOutContainer" class="hidden">
            <label class="label" for="date_out">
              <span class="label-text">Flight Out</span>
            </label>
            <select name="date_out" id="date_out"
                    class="select select-bordered w-full"
                    data-ryanair-search-target="dateOutSelect"
                    data-action="change->ryanair-search#dateOutChanged">
              <option value="">Select a date</option>
            </select>
          </div>

          <!-- Date In -->
          <div class="form-control" data-ryanair-search-target="dateInContainer" class="hidden">
            <label class="label" for="date_in">
              <span class="label-text">Flight Back</span>
            </label>
            <select name="date_in" id="date_in"
                    class="select select-bordered w-full"
                    data-ryanair-search-target="dateInSelect"
                    data-action="change->ryanair-search#dateInChanged">
              <option value="">Select a date</option>
            </select>
          </div>

          <!-- Submit Button -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base-content/70" data-ryanair-search-target="tripDuration">&nbsp;</span>
            </label>
            <button type="submit"
                    class="btn btn-primary w-full"
                    data-ryanair-search-target="submitButton"
                    disabled>
              Save Flight Search
            </button>
          </div>
        </div>

        <!-- Loading Indicator -->
        <div data-ryanair-search-target="loadingIndicator" class="hidden mt-4">
          <span class="loading loading-spinner loading-sm text-primary"></span>
          <span class="ml-2 text-sm text-base-content/70">Loading available dates...</span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Saved Searches Card -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Your Saved Flight Searches</h2>

      <% if @saved_searches.any? %>
        <div class="divide-y divide-base-300">
          <% @saved_searches.each do |search| %>
            <div class="py-3 flex items-center justify-between gap-4">
              <!-- Route -->
              <div class="font-medium whitespace-nowrap">
                RIX <span class="text-base-content/50">→</span> <%= search.ryanair_destination.display_name %> <span class="text-base-content/50">→</span> RIX
                <span class="text-xs text-base-content/50 font-normal ml-1">(<%= search.trip_duration %>d)</span>
              </div>

              <!-- Flight Times -->
              <% if search.has_flight_times? %>
                <div class="flex items-center gap-3">
                  <!-- Outbound -->
                  <div class="text-center">
                    <div class="text-xs text-base-content/70"><%= search.departure_time_out.strftime("%d/%m/%Y") %></div>
                    <div class="flex items-center gap-1 text-sm font-medium">
                      <span><%= search.departure_time_out.strftime("%H:%M") %></span>
                      <span class="text-base-content/50">→</span>
                      <span><%= search.arrival_time_out.strftime("%H:%M") %></span>
                    </div>
                  </div>

                  <!-- Exchange Arrow -->
                  <div class="text-base-content/30">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                    </svg>
                  </div>

                  <!-- Inbound -->
                  <div class="text-center">
                    <div class="text-xs text-base-content/70"><%= search.departure_time_in.strftime("%d/%m/%Y") %></div>
                    <div class="flex items-center gap-1 text-sm font-medium">
                      <span><%= search.departure_time_in.strftime("%H:%M") %></span>
                      <span class="text-base-content/50">→</span>
                      <span><%= search.arrival_time_in.strftime("%H:%M") %></span>
                    </div>
                  </div>
                </div>
              <% else %>
                <div class="text-sm text-base-content/70">
                  <%= search.date_out.strftime("%d/%m/%Y") %> - <%= search.date_in.strftime("%d/%m/%Y") %>
                </div>
              <% end %>

              <!-- Price -->
              <div class="text-left shrink-0 w-24">
                <% if search.total_price %>
                  <p class="text-lg font-semibold text-success">&euro;<%= number_with_precision(search.total_price, precision: 2) %></p>
                <% else %>
                  <p class="text-lg font-semibold text-base-content/30">-</p>
                <% end %>
              </div>

              <!-- Actions & Sync -->
              <div class="flex flex-col items-center shrink-0">
                <div class="flex items-center gap-1">
                  <%= button_to tickets_ryanair_refresh_price_path(search.id), method: :post, class: "btn btn-ghost btn-sm btn-square", title: "Refresh price" do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                  <% end %>
                  <%= button_to tickets_ryanair_delete_path(search.id), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this flight search?" }, class: "btn btn-ghost btn-sm btn-square text-error", title: "Delete" do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  <% end %>
                </div>
                <% if search.priced_at.present? %>
                  <span class="text-xs text-base-content/50"><%= time_ago_in_words(search.priced_at) %> ago</span>
                <% elsif search.pending? %>
                  <span class="badge badge-warning badge-xs">Pending</span>
                <% elsif search.error? %>
                  <span class="badge badge-error badge-xs">Error</span>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <svg class="mx-auto h-12 w-12 text-base-content/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          <h3 class="mt-2 font-medium">No flight searches</h3>
          <p class="mt-1 text-sm text-base-content/70">Get started by searching for a flight above.</p>
        </div>
      <% end %>
    </div>
  </div>

  <% if @destinations.empty? %>
    <div role="alert" class="alert alert-warning">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <span>No destinations available. Please run <kbd class="kbd kbd-sm">bin/rails ryanair:sync_routes</kbd> to fetch destinations.</span>
    </div>
  <% end %>
</div>
